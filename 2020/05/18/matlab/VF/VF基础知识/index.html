
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VF基础知识 - ESY</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="ESY,"> 
    <meta name="description" content="miao,心室纤颤(Ventricular Fibrillation ，VF)心室纤颤(Ventricular Fibrillation ，VF)特点：
QRS-T波群完全消失，代之以形态不同、大小各异间距极,"> 
    <meta name="author" content="esy"> 
    <link rel="alternative" href="atom.xml" title="ESY" type="application/atom+xml"> 
    <link rel="icon" href="/img/hhh.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
</head>

<body class="loading">
    <span id="config-title" style="display:none">ESY</span>
    <div id="loader"></div>
​    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;" target="_blank" rel="noopener" data-url="https://esyyes.github.io"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">VF基础知识</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" target="_blank" rel="noopener" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;" target="_blank" rel="noopener"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">VF基础知识</h1>
        <div class="stuff">
            <span>五月 18, 2020</span>
            

        </div>
        <div class="content markdown">
            <h2 id="心室纤颤-Ventricular-Fibrillation-，VF"><a href="#心室纤颤-Ventricular-Fibrillation-，VF" class="headerlink" title="心室纤颤(Ventricular Fibrillation ，VF)"></a>心室纤颤(Ventricular Fibrillation ，VF)</h2><p>心室纤颤(Ventricular Fibrillation ，VF)特点：</p>
<p>QRS-T波群完全消失，代之以形态不同、大小各异间距极不匀齐的颤动波(f波)，频率为250～500次/分钟，颤动波之间无等电线。</p>
<p><strong>心室扑动典型的心电图特点</strong></p>
<p>连续而规则、宽大、畸形的QRS波，即心室扑动波。QRS波的时限长，在0.12s以上，QRS波呈向上向下的波幅似正弦样曲线与T波无法分开，QRS波之间无等电线。QRS波频率多在180～250次/分钟，有时可低达150次/分钟或高达300次/分钟。P波消失。</p>
<h2 id="心室纤颤的数据库："><a href="#心室纤颤的数据库：" class="headerlink" title="心室纤颤的数据库："></a>心室纤颤的数据库：</h2><p><img src="H:%5Cmyboke%5Cmybike%5Csource%5Cimages%5C%E5%BF%83%E7%94%B5%E6%95%B0%E6%8D%AE%E5%BA%93.png" alt="image-20200519141433962"></p>
<p><img src="H:%5Cmyboke%5Cmybike%5Csource%5Cimages%5Cvfdb%E4%BB%8B%E7%BB%8D.png" alt="image-20200519141519264"></p>
<h2 id="数据长短："><a href="#数据长短：" class="headerlink" title="数据长短："></a>数据长短：</h2><p><img src="H:%5Cmyboke%5Cmybike%5Csource%5Cimages%5C%E5%88%86%E6%9E%90%E6%95%B0%E6%8D%AE%E9%95%BF%E7%9F%AD.png" alt="image-20200519141626942"></p>
<p><img src="H:%5Cmyboke%5Cmybike%5Csource%5Cimages%5CMITDB%E6%95%B0%E6%8D%AE%E9%80%89%E6%8B%A9" alt="image-20200519141744095"></p>
<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>直接选择数据库为VFDB，室颤的，然后根据标签选择室颤的信号，筛选10个的样子，每个10s，然后生成excel表格，再选择正常的数据10段，最后来区分，利用利用python直接来读取数据，然后生成数据组合!再进行预处理。最后筛选出一个算法进行进行分类，并有个准确率输出。</p>
<h1 id="VF数据库"><a href="#VF数据库" class="headerlink" title="VF数据库"></a>VF数据库</h1><p>含有室颤的数据有：424,426,430</p>
<p>数据长短为：2100s，35min</p>
<p>采样率为：250</p>
<p>首先确定VF和VFIB的位置，将其生成excel文档，10s长短，即2500数据点，</p>
<h2 id="python-wfdb截取数据"><a href="#python-wfdb截取数据" class="headerlink" title="python-wfdb截取数据"></a>python-wfdb截取数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time     : 2020/5/19</span></span><br><span class="line"><span class="comment"># @Author   : esy</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> wfdb <span class="keyword">as</span> wfdb</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"></span><br><span class="line"><span class="comment"># 忽略警告</span></span><br><span class="line">warnings.filterwarnings(<span class="string">"ignore"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据标签筛选出室颤信号</span></span><br><span class="line">record = wfdb.rdrecord(<span class="string">'F:/VF/VFDB/424'</span>, channels=[<span class="number">0</span>], sampfrom=<span class="number">314749</span>, sampto=<span class="number">341173</span>)</span><br><span class="line">VF = record.p_signal</span><br><span class="line"></span><br><span class="line">vf = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(record.sig_len):</span><br><span class="line">    vf.append(VF[i][<span class="number">0</span>])</span><br><span class="line">vf = vf[<span class="number">5000</span>:<span class="number">7500</span>]</span><br><span class="line"></span><br><span class="line">fig = plt.figure(figsize=(<span class="number">7</span>, <span class="number">4</span>))</span><br><span class="line">plt.plot(vf, linewidth=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">plt.ylabel(<span class="string">"U/mv"</span>, fontsize=<span class="number">10</span>)</span><br><span class="line">plt.xticks(fontsize=<span class="number">8</span>)</span><br><span class="line">plt.xlabel(<span class="string">"time/s"</span>, fontsize=<span class="number">10</span>)</span><br><span class="line">plt.yticks(fontsize=<span class="number">8</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = pd.DataFrame(vf)</span><br><span class="line">data.to_excel(<span class="string">"vf1.xlsx"</span>)</span><br></pre></td></tr></table></figure>

<p><img src="H:%5Cmyboke%5Cmybike%5Csource%5Cimages%5CVF%E7%9A%84%E6%95%B0%E6%8D%AE%E6%A0%B7%E6%9C%AC10s%E7%9A%84%E3%80%91.png" alt="image-20200520104746150"></p>
<p><strong>筛选10个数据片段</strong></p>
<p><strong>筛选正常数据</strong></p>
<p>下一步就是用算法将其判断出来，写个循环看看，Ndata数据的效果，用pt算法，另外一个也试试</p>
<p>数据片段的筛选，重新保存筛选，先选择算法进行分析。</p>
<p>TCI算法：</p>
<p><a href="https://link.springer.com/article/10.1186/1475-925X-4-60" target="_blank" rel="noopener">https://link.springer.com/article/10.1186/1475-925X-4-60</a></p>
<p>随便设定一个大于250和小于250就行了</p>
<p> 纪念下人生第一单哈哈哈</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">clc;clear;close all</span><br><span class="line">% 读取室颤数据</span><br><span class="line">data = xlsread(&apos;F:\VF\VFdata\0.xlsx&apos;);</span><br><span class="line">% 读取正常数据</span><br><span class="line">% data = xlsread(&apos;F:\VF\Ndata\0.xlsx&apos;);</span><br><span class="line"></span><br><span class="line">% 采样频率</span><br><span class="line">fs = 250;</span><br><span class="line"></span><br><span class="line">% 想要采样的时间长度为10s，所以数据长短通通为2500</span><br><span class="line">vf = data(2:2501, 2);</span><br><span class="line"></span><br><span class="line">% 将采样点的横坐标转换为s</span><br><span class="line">N = length(vf);</span><br><span class="line">m = 0 : N-1;</span><br><span class="line">t = m / fs;</span><br><span class="line"></span><br><span class="line">% 绘制出原始数据</span><br><span class="line">subplot(2,1,1)</span><br><span class="line">plot(t,vf,&apos;b&apos;);</span><br><span class="line"></span><br><span class="line">title(&apos;原始信号&apos;);</span><br><span class="line">xlabel(&apos;time/s&apos;);</span><br><span class="line">ylabel(&apos;U/mV&apos;);</span><br><span class="line"></span><br><span class="line">% 可要可不要这一步将数据平滑一下</span><br><span class="line">subplot(2,1,2)</span><br><span class="line">df = smooth(vf,3);</span><br><span class="line">plot(t,df);</span><br><span class="line">title(&apos;平滑后的信号&apos;);</span><br><span class="line">xlabel(&apos;time/s&apos;);</span><br><span class="line">ylabel(&apos;U/mV&apos;);</span><br><span class="line"></span><br><span class="line">% 利用TCI (Threshold crossing intervals)算法对TCI值进行判断</span><br><span class="line">% verbose = 0数据直接输出8个3s窗口的平均值，verbose = 1，进入调试界面</span><br><span class="line">verbose = 1;</span><br><span class="line">tci = VF_TCI(vf,fs,10,verbose);</span><br><span class="line"></span><br><span class="line">% VF的频率为250～500次/分钟，转换为ms为120-240ms，即可判定为室颤</span><br><span class="line">if (tci &gt;= 120) &amp;&amp; (tci &lt;= 240)</span><br><span class="line">    disp(&apos;该信号为室颤信号&apos;)</span><br><span class="line">else</span><br><span class="line">    disp(&apos;该信号为正常信号&apos;)</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>读取单个的图</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">clc;clear;close all</span><br><span class="line"></span><br><span class="line"><span class="comment">% 数据标签，将VF数据判定为1，正常的判定为0</span></span><br><span class="line">tag = [];</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">0</span> : <span class="number">31</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">i</span> &lt;= <span class="number">18</span></span><br><span class="line">        tag(<span class="built_in">i</span>+<span class="number">1</span>,<span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        tag(<span class="built_in">i</span>+<span class="number">1</span>,<span class="number">1</span>) = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% 循环读取数据，将VF数据判定为1，正常的判定为0</span></span><br><span class="line">num_vf = <span class="number">0</span>;</span><br><span class="line">num_n = <span class="number">0</span>;</span><br><span class="line">all = [];</span><br><span class="line">TCI = [];</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">0</span> : <span class="number">31</span></span><br><span class="line">    data = xlsread([<span class="string">'F:\VF\all_data\', num2str(i), '</span>.xlsx']);</span><br><span class="line">    fs = <span class="number">250</span>;</span><br><span class="line">    vf = data(<span class="number">2</span>:<span class="number">2501</span>, <span class="number">2</span>);    </span><br><span class="line">    tci = VF_TCI(vf,fs,<span class="number">10</span>,<span class="number">0</span>);</span><br><span class="line">    TCI(<span class="built_in">i</span>+<span class="number">1</span>,<span class="number">1</span>) = tci;</span><br><span class="line">    <span class="keyword">if</span> (tci &gt;= <span class="number">120</span>) &amp;&amp; (tci &lt;= <span class="number">240</span>)</span><br><span class="line">        num_vf = num_vf + <span class="number">1</span>;</span><br><span class="line">        all(<span class="built_in">i</span>+<span class="number">1</span>,<span class="number">1</span>) = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        num_n = num_n + <span class="number">1</span>;</span><br><span class="line">        all(<span class="built_in">i</span>+<span class="number">1</span>,<span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% 进行比较，用标签和这个你判定的数据进行比较</span></span><br><span class="line">ALL = <span class="number">32</span>;</span><br><span class="line">True = <span class="number">0</span>;</span><br><span class="line">F = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">0</span> : <span class="number">31</span></span><br><span class="line">    <span class="keyword">if</span> all(<span class="built_in">i</span>+<span class="number">1</span>,<span class="number">1</span>) == tag(<span class="built_in">i</span>+<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        True = True + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        F = F + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span>     </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">% 输出得到判定准确的值，差不多准确率就基本可以了，毕竟100%了，再转换为百分数</span></span><br><span class="line">ACR = True / ALL;</span><br><span class="line">accuracy = strcat(num2str(ACR * <span class="number">100</span>),<span class="string">'%'</span>);</span><br><span class="line"><span class="built_in">disp</span>([<span class="string">'准确率为:'</span>,accuracy]);</span><br></pre></td></tr></table></figure>

<p>输出为准确率</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tci</span> = <span class="title">VF_TCI</span><span class="params">(xf,fs,wL,verbose)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">% INPUT:</span></span><br><span class="line"><span class="comment">% - xf: ecg signal (preprocessed)</span></span><br><span class="line"><span class="comment">% - fs: sampling frequency</span></span><br><span class="line"><span class="comment">% - wL: window length, in seconds </span></span><br><span class="line"><span class="comment">% - verbose: debugging variable (1: plot; 0: default, not ploting)</span></span><br><span class="line"><span class="comment">%</span></span><br><span class="line"><span class="comment">% OUTPUT</span></span><br><span class="line"><span class="comment">% - tci parameter</span></span><br><span class="line"></span><br><span class="line">wl = <span class="number">1</span>*fs;  <span class="comment">% 1-sec window samples</span></span><br><span class="line">wa = <span class="number">3</span>*fs;  <span class="comment">% 3-sec window samples</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">L = wL<span class="number">-3</span>+<span class="number">1</span>; <span class="comment">% number of 3-sec windows in wl segment </span></span><br><span class="line"></span><br><span class="line"><span class="comment">%becg = zeros(1,wa);</span></span><br><span class="line">becg1 = <span class="built_in">zeros</span>(<span class="number">1</span>,wl);</span><br><span class="line">becg2 = <span class="built_in">zeros</span>(<span class="number">1</span>,wl);</span><br><span class="line">becg3 = <span class="built_in">zeros</span>(<span class="number">1</span>,wl);</span><br><span class="line"></span><br><span class="line">tci6 = <span class="built_in">zeros</span>(<span class="number">1</span>,L);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">j</span>=<span class="number">0</span>:L<span class="number">-1</span></span><br><span class="line">    wsamples1 = <span class="built_in">j</span>*wl+<span class="number">1</span>:(<span class="built_in">j</span>+<span class="number">1</span>)*wl;</span><br><span class="line">    wsamples2 = (<span class="built_in">j</span>+<span class="number">1</span>)*wl+<span class="number">1</span>:(<span class="built_in">j</span>+<span class="number">2</span>)*wl;</span><br><span class="line">    wsamples3 = (<span class="built_in">j</span>+<span class="number">2</span>)*wl+<span class="number">1</span>:(<span class="built_in">j</span>+<span class="number">3</span>)*wl;</span><br><span class="line">    </span><br><span class="line">    stage1 = xf(wsamples1)-<span class="built_in">mean</span>(xf(wsamples1)); maxv = <span class="built_in">max</span>(stage1); </span><br><span class="line">    th1 = <span class="number">0.2</span>*maxv; becg1(stage1&gt;th1) = <span class="number">1</span>;</span><br><span class="line">    stage2 = xf(wsamples2)-<span class="built_in">mean</span>(xf(wsamples2)); maxv = <span class="built_in">max</span>(stage2); </span><br><span class="line">    th2 = <span class="number">0.2</span>*maxv; becg2(stage2&gt;th2) = <span class="number">1</span>;</span><br><span class="line">    stage3 = xf(wsamples3)-<span class="built_in">mean</span>(xf(wsamples3)); maxv = <span class="built_in">max</span>(stage3); </span><br><span class="line">    th3 = <span class="number">0.2</span>*maxv; becg3(stage3&gt;th3) = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    becg = [becg1 becg2 becg3];</span><br><span class="line">    </span><br><span class="line">    aux = [<span class="number">0</span> diff(becg)];</span><br><span class="line">    </span><br><span class="line">    s1 = <span class="built_in">find</span>(aux(<span class="number">1</span>:wl)==<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isempty</span>(s1)</span><br><span class="line">        t1 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        t1 = (wl-s1(<span class="keyword">end</span>))/fs;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    index = <span class="built_in">find</span>(aux(wl+<span class="number">1</span>:<span class="number">2</span>*wl));</span><br><span class="line">    s2 = aux(wl+<span class="number">1</span>:<span class="number">2</span>*wl);</span><br><span class="line">    pulses = s2(index);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> pulses(<span class="number">1</span>) == <span class="number">-1</span> &amp;&amp; pulses(<span class="keyword">end</span>) == <span class="number">-1</span></span><br><span class="line">        t2 = <span class="number">0</span>;</span><br><span class="line">        t3 = (wl-index(<span class="keyword">end</span>))/fs;</span><br><span class="line">        N = (<span class="built_in">length</span>(pulses)+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elseif</span> pulses(<span class="number">1</span>) == <span class="number">1</span> &amp;&amp; pulses(<span class="keyword">end</span>) == <span class="number">1</span></span><br><span class="line">        t2 = index(<span class="number">1</span>)/fs;</span><br><span class="line">        t3 = <span class="number">0</span>;</span><br><span class="line">        N = (<span class="built_in">length</span>(pulses)+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elseif</span> pulses(<span class="number">1</span>) == <span class="number">-1</span> &amp;&amp; pulses(<span class="keyword">end</span>) == <span class="number">1</span></span><br><span class="line">        t2 = <span class="number">0</span>;</span><br><span class="line">        t3 = <span class="number">0</span>;</span><br><span class="line">        N = (<span class="built_in">length</span>(pulses)+<span class="number">2</span>)/<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elseif</span> pulses(<span class="number">1</span>) == <span class="number">1</span> &amp;&amp; pulses(<span class="keyword">end</span>) == <span class="number">-1</span></span><br><span class="line">        t2 = index(<span class="number">1</span>)/fs;</span><br><span class="line">        t3 = (wl-index(<span class="keyword">end</span>))/fs;</span><br><span class="line">        N = (<span class="built_in">length</span>(pulses))/<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">disp</span>(<span class="string">'This should not be happening!'</span>)</span><br><span class="line">        keyboard; <span class="comment">%better to debug</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">       </span><br><span class="line">    s4 = <span class="built_in">find</span>(aux(<span class="number">2</span>*wl+<span class="number">1</span>:<span class="number">3</span>*wl)==<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isempty</span>(s4)</span><br><span class="line">        t4 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        t4 = s4(<span class="number">1</span>)/fs;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">    tci6(<span class="built_in">j</span>+<span class="number">1</span>) = <span class="number">1000</span>/((N<span class="number">-1</span>)+(t2/(t1+t2))+(t3/(t3+t4)));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">%Plot data</span></span><br><span class="line">    <span class="keyword">if</span> verbose</span><br><span class="line">        </span><br><span class="line">        f = <span class="built_in">figure</span>;</span><br><span class="line">        t = [wsamples1 wsamples2 wsamples3]/fs;</span><br><span class="line">        stage = [stage1' stage2' stage3'];</span><br><span class="line">        </span><br><span class="line">        subplot(<span class="number">211</span>)        </span><br><span class="line">        <span class="built_in">plot</span>(t,stage); <span class="built_in">hold</span> on;</span><br><span class="line">        <span class="built_in">plot</span>(t,[th1*<span class="built_in">ones</span>(<span class="number">1</span>,wl) th2*<span class="built_in">ones</span>(<span class="number">1</span>,wl) th3*<span class="built_in">ones</span>(<span class="number">1</span>,wl)],<span class="string">'r'</span>);</span><br><span class="line">        xlabel(<span class="string">'time/s'</span>);</span><br><span class="line">        ylabel(<span class="string">'ECG and threshold'</span>);</span><br><span class="line">        </span><br><span class="line">        subplot(<span class="number">212</span>);</span><br><span class="line">        <span class="built_in">plot</span>(t,becg,<span class="string">'k'</span>); <span class="built_in">hold</span> on; stem(t,aux,<span class="string">'r'</span>); <span class="built_in">hold</span> on;</span><br><span class="line">        line([<span class="built_in">j</span>+<span class="number">1</span> <span class="built_in">j</span>+<span class="number">1</span>],[<span class="number">-1.2</span> <span class="number">1.2</span>]);line([<span class="built_in">j</span>+<span class="number">2</span> <span class="built_in">j</span>+<span class="number">2</span>],[<span class="number">-1.2</span> <span class="number">1.2</span>]);</span><br><span class="line">        axis([t(<span class="number">1</span>) t(<span class="keyword">end</span>) <span class="number">-1.2</span> <span class="number">1.2</span>])</span><br><span class="line">        xlabel(<span class="string">'time/s'</span>);</span><br><span class="line">        ylabel(<span class="string">'pulses'</span>);</span><br><span class="line">        msg = sprintf(<span class="string">'t_1=%2.2f\t\t t_2=%2.2f\t\t t_3=%2.2f\t\t t_4=%2.2f'</span>,...</span><br><span class="line">            t1,t2,t3,t4);</span><br><span class="line">        title(msg)</span><br><span class="line">        text(<span class="built_in">j</span>+<span class="number">1.2</span>,<span class="number">-0.5</span>,[<span class="string">'TCI = '</span> num2str(tci6(<span class="built_in">j</span>+<span class="number">1</span>))])</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="built_in">hold</span> off</span><br><span class="line">        <span class="comment">% 是否进行调试，观看效果</span></span><br><span class="line">        keyboard;</span><br><span class="line">        close(f);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    becg1 = <span class="built_in">zeros</span>(<span class="number">1</span>,wa/<span class="number">3</span>);</span><br><span class="line">    becg2 = <span class="built_in">zeros</span>(<span class="number">1</span>,wa/<span class="number">3</span>);</span><br><span class="line">    becg3 = <span class="built_in">zeros</span>(<span class="number">1</span>,wa/<span class="number">3</span>);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">tci = <span class="built_in">mean</span>(tci6);</span><br></pre></td></tr></table></figure>

<p>TCI算法</p>
<p><img src="H:%5Cmyboke%5Cmybike%5Csource%5Cimages%5CTCI%E7%AE%97%E6%B3%95%E5%BE%97%E5%88%B0%E7%9A%84%E5%9B%BE" alt="image-20200520195855735"></p>
<p>准确率为100%结束</p>
<p><img src="http://img1.cache.netease.com/96/2014/8/12/2014081209202754754.jpg" alt=""></p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='https://link.hhtjim.com/163/509313159.mp3'></li>
                        
                    
                        
                            <li title='1' data-url='https://link.hhtjim.com/163/579954.mp3'></li>
                        
                    
                        
                            <li title='2' data-url='https://link.hhtjim.com/163/579648.mp3'></li>
                        
                    
                        
                            <li title='3' data-url='https://link.hhtjim.com/163/40915694.mp3'></li>
                        
                    
                </ul>
            
        </div>
        

    </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>